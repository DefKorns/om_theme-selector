theme_randomizR() {
	local cloverTheme="$mountpoint/usr/share/ui/$sftype-$sfregion"
	sysType="$sftype"

	case "$sftype" in
	hvcj)
		cloverTheme="$mountpoint/usr/share/ui/hvc"
		sysType="shonen"
		;;
	nes)
		cloverTheme="$mountpoint/usr/share/clover-ui"
		[ "$sfregion" = "jpn" ] && sysType="hvc"
		;;
	snes)
		[ "$sfregion" = "jpn" ] && cloverTheme="$mountpoint/usr/share/ui/shvc"
		;;
	esac

	local themePath="$mountpoint/media/$modname/themes/$sysType"
	statePath="$mountpoint$profilepath/$modname"
	local folderId
	folderId="$(cat "$statePath/menu")"
	local activeFolder="CLV-S-00$folderId"
	local prevTheme="none"
	[ -f "$statePath/lastTheme" ] && prevTheme=$(cat "$statePath/lastTheme")
	local gStorage
	gStorage="$(findGameStorage)"
	local getName
	local fullPath
	local themeMatch
	local theme="$prevTheme"
	local pID
	local parentID
	local parentName
	local hasParent

	[ ! -d "$themePath" ] && themePath="$rootfs/usr/share/themes/$sysType"

	find "$gStorage" -maxdepth 3 -type f -name "$activeFolder.desktop" | sort -u | while IFS= read -r desktopFile; do
		cd "$gStorage" || exit
		for i in $(find . -type d -name "$activeFolder" | sed "s|^\./||"); do
			if [ "$(grep -L "Name=Back" "$i/$(basename "$i").desktop")" ]; then
				pID="$(dirname "$i")"
				local parentID="CLV-S-00$pID"
			fi
		done
		find "." -maxdepth 3 -type f -name "$parentID.desktop" -exec grep -L "Name=Back" {} \; >tmp
		while IFS= read -r w; do
			parentName="$(grep -F 'Name=' "$w" | sed -r 's/Name=//g;s/ /_/g' | awk '{print tolower($0)}')"
		done <tmp

		hasParent="$(find "$themePath" -maxdepth 1 -type d | xargs -n 1 basename | grep -w "$parentName")"
		getName="$(grep -F 'Name=' "$desktopFile" | sed -r '/[Bb]ack/d;s/Name=//g;s/ /_/g' | awk '{print tolower($0)}')"
		themeMatch="$(find "$themePath" -maxdepth 1 -type d | xargs -n 1 basename | grep -w "$getName")"

		#if [ -z "$getName" ]; 
		if [ "$folderId" == "000" ] && [ -d "$themePath/default" ]; then
			fullPath="$themePath/default"
			echo "default" >"$statePath/lastTheme"
		elif [ -n "$themeMatch" ]; then
			fullPath="$themePath/$getName"
			echo "$getName" >"$statePath/lastTheme"
		elif [ -n "$hasParent" ]; then
			fullPath="$themePath/$parentName"
			echo "$getName" >"$statePath/lastTheme"
		else
			while [ "$theme" == "$prevTheme" ]; do
				theme="$(find "$themePath" -maxdepth 1 -type d | shuf | head -n1 | xargs -n 1 basename)"
			done
			fullPath="$themePath/$theme"
			echo "$theme" >"$statePath/lastTheme"
		fi
		echo "$fullPath" >"$statePath/activeTheme"

		cd "$themePath/$prevTheme" && find ./* -type f | cut -c3- | while IFS= read -r uFile; do
			umount "$cloverTheme/$uFile"
		done

		cd "$fullPath" && find . -type f | while IFS= read -r tfile; do

			[ -n "$theme" ] && [ -f "$fullPath/$tfile" ] && mount_bind "$fullPath/$tfile" "$cloverTheme/$tfile"
		done
		cd - >/dev/ || exit
	done
}
